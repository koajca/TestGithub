<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/WEB-INF/templates/template.xhtml"                
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <!--    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"-->
    <ui:define name="metadata">
    </ui:define>
    <ui:define name="content">
        <section class="content-header">
            <h1>
                <h:outputText value="#{lang['query.transaction.title']}"/>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#{request.contextPath}/pages/home.xhtml"><i class="fa fa-dashboard"></i> <h:outputText value="#{lang['nav.home']}"/></a></li>
                <li class="active"><h:outputText value="#{lang['query.transaction.title']}"/></li>
            </ol>
        </section>
        <section class="content">
            <h:form id="formSearch">
                <div class="box box-primary">
                    <div class="box-body">
                        <div class="row"> 
                            <!--<label class="col-sm-2 control-label">Từ ngày</label>-->
                            <p:messages id="msgError" autoUpdate="true" showSummary="true" />
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="fromDate" value="#{lang['query.transaction.lbl.fromDate']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:calendar id="fromDate" value="#{queryTransactionBean.transForm.fromDate}" showOn="button" required="true" requiredMessage="#{msg['query.transaction.from.date.not.empty']}" converterMessage="#{msg['query.transaction.from.date.invalid']}"  />
                                <!--<p:message for="fromDate" />-->
                            </div>
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="toDate" value="#{lang['query.transaction.lbl.toDate']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:calendar id="toDate" value="#{queryTransactionBean.transForm.toDate}" showOn="button" required="true" requiredMessage="#{msg['query.transaction.to.date.not.empty']}"/>
                                <!--<p:message for="toDate" />-->
                            </div>
                        </div>
                        <div class="row"> 
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="transId" value="#{lang['query.transaction.lbl.transId']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:inputText id="transId" value="#{queryTransactionBean.transForm.transId}" validatorMessage="#{msg['query.transaction.trans.id.msg.error.maxleng']}" >
                                    <f:validateLength minimum="1" maximum="20" />
                                </p:inputText>
                                <!--<p:message for="transId" />-->
                            </div>
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="requestId" value="#{lang['query.transaction.lbl.requestId']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:inputText id="requestId" value="#{queryTransactionBean.transForm.cpTransId}" validatorMessage="#{msg['query.transaction.cpTrans.Id.msg.error.maxleng']}">
                                    <f:validateLength minimum="1" maximum="20" />
                                </p:inputText>
                                <!--<p:message for="requestId" />-->
                            </div>
                        </div>
                        <div class="row">
                            <!--<label class="col-sm-2 control-label">Từ ngày</label>-->
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="paymentId" value="#{lang['query.transaction.lbl.paymentId']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:inputText id="paymentId"  value="#{queryTransactionBean.transForm.paymentId}" validatorMessage="#{msg['query.transaction.payment.Id.msg.error.maxleng']}">
                                    <f:validateLength minimum="1" maximum="20" />
                                </p:inputText>
                            </div>
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="cpName" value="#{lang['query.transaction.lbl.cp']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:selectOneMenu id="cpName" value="#{queryTransactionBean.transForm.cpId}" 
                                                 style="width:180px"
                                                 filter="true"
                                                 filterMatchMode="contains">
                                    <f:selectItem itemLabel="#{lang['searchTransactionBank.chooseCp.default']}" 
                                                  itemValue="-1"
                                                  noSelectionOption="true" 
                                                  />
                                    <f:selectItems value="#{searchTransactionBank.listContentProvider}" 
                                                   var="item" 
                                                   itemLabel="#{item.CP_NAME}" 
                                                   itemValue="#{item.CONTENT_PROVIDER_ID}" 
                                                   noSelectionValue="true"/>
                                </p:selectOneMenu>
                            </div>
                        </div>
                        <div class="row"> 
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="bankId" value="#{lang['query.transaction.lbl.bank']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:selectOneMenu id="bankId" value="#{queryTransactionBean.transForm.bankCode}" style="width:150px">
                                    <f:selectItem itemLabel="#{lang['query.transaction.lbl.bank.default']}" itemValue=""/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.lbl.bank.mb']}" itemValue="mb"/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.lbl.bank.vcb']}" itemValue="vcb"/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.lbl.bank.bidv']}" itemValue="bidv"/>
                                </p:selectOneMenu>
                            </div>
                            <div class="col-sm-2 text-right">
                                <p:outputLabel for="status" value="#{lang['query.transaction.lbl.status']}" />
                            </div>
                            <div class="col-sm-3">
                                <p:selectOneMenu id="status" value="#{queryTransactionBean.transForm.status}" style="width:150px">
                                    <f:selectItem itemLabel="#{lang['query.transaction.status.default']}" itemValue=""/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.status.0']}" itemValue="0"/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.status.1']}" itemValue="1"/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.status.2']}" itemValue="2"/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.status.3']}" itemValue="3"/>
                                    <f:selectItem itemLabel="#{lang['query.transaction.status.4']}" itemValue="4"/>
                                </p:selectOneMenu>
                            </div>
                        </div>
                    </div>
                    <div class="box-footer">
                        <div class="col-xs-10 text-center">
                            <p:commandButton value="#{lang['query.transaction.btn.search']}" id="btnSearch"  
                                             action="#{queryTransactionBean.searchTrans()}" 
                                             styleClass="btn btn-primary" 
                                             ajax="false" validateClient="true" 
                                             update="msgError" />
                            <p:commandButton value="#{lang['query.transaction.btn.export']}"  id="btnExport" 
                                             styleClass="btn btn-info"
                                             ajax="false" update="msgError" validateClient="true" 
                                             onclick="PrimeFaces.monitorDownload(start, stop);">
                                <p:fileDownload value="#{queryTransactionBean.file}" />
                            </p:commandButton>
                        </div>
                    </div>
                </div>
                <div class="box box-info">
                    <div class="box-header"><h:outputLabel value="#{lang['query.transaction.lbl.search.result']}" /></div>
                    <div class="box-body" style="overflow-x: scroll">
                        <p:dataTable var="trans" value="#{queryTransactionBean.listTrans}" rows="10"
                                     id="mydata" paginator="true" 
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowIndexVar="indexVar"
                                     >
                            <!--                                resizableColumns="true"-->
                            <!--rowsPerPageTemplate="5,10,15"-->
                            <p:column headerText="#{lang['query.transaction.lbl.index']}" width="5%">
                                <h:outputText value="#{indexVar + 1}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.bankCode']}" width="5%">
                                <h:outputText value="#{trans.BANKCODE}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.cpId']}" width="5%">
                                <!--<h:outputText value="#{trans.CONTENTPROVIDERID}" />-->
                                <h:outputText value="#{trans.CPCODE}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.cpName']}" width="15%">
                                <h:outputText value="#{trans.CPNAME}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.transId']}" width="5%">
                                <h:outputText value="#{trans.TRANSID}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.orderId']}" width="15%">
                                <h:outputText value="#{trans.ORDERID}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.billingCode']}" width="5%">
                                <h:outputText value="#{trans.BILLINGCODE}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.amount']}" width="5%">
                                <div class="text-right">
                                    <h:outputText value="#{trans.AMOUNT}">
                                        <f:convertNumber pattern="#0,000" />
                                    </h:outputText>
                                </div>
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.requestDate']}" width="5%">
                                <h:outputText value="#{trans.REQUESTDATE}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.orderInfo']}" width="15%">
                                <h:outputText value="#{trans.ORDERINFO}" />
                            </p:column>
                            <p:column headerText="#{lang['query.transaction.lbl.transStatus']}" width="10%">
                                <h:outputText value="#{lang['query.transaction.lbl.confirmStatus.pending']}" rendered="#{trans.TRANSSTATUS eq 0}"/>
                                <h:outputText value="#{lang['query.transaction.lbl.confirmStatus.processing']}" rendered="#{trans.TRANSSTATUS eq 1}"/>
                                <h:outputText value="#{lang['query.transaction.lbl.confirmStatus.success']}" rendered="#{trans.TRANSSTATUS eq 2}"/>
                                <h:outputText value="#{lang['query.transaction.lbl.confirmStatus.cancelled']}" rendered="#{trans.TRANSSTATUS eq 3}"/>
                                <h:outputText value="#{lang['query.transaction.lbl.confirmStatus.failed']}" rendered="#{trans.TRANSSTATUS eq 4}"/>
                            </p:column>                            
                            <p:column style="width:32px;text-align: center" headerText="#{lang['query.transaction.lbl.detail']}" width="5%" >
                                <p:commandButton icon="ui-icon-search" 
                                                 actionListener="#{queryTransactionBean.viewDetail(trans)}" 
                                                 update=":frmTransDetail:idDlg" 
                                                 oncomplete="PF('dlgDetail').show();"/>
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>
            </h:form>
            <h:form id="frmTransDetail">
                <p:dialog header="#{lang['searchTransactionBank.detail.title']}" 
                          widgetVar="dlgDetail" 
                          modal="true" 
                          closable="true" 
                          id="idDlg" 
                          width="800" height="500">
                        <div class="box box-info">
                            <div class="box-body">
                                <p:messages id="msgErrorDetail" autoUpdate="true" showSummary="true" />
                                <label class="control-label">#{lang['searchTransactionBank.detail.infoTran']}</label>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.bankCode']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.BANKCODE}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.cpCode']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.CPCODE}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.cpName']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.CPNAME}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.requestId']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.TRANSID}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.requestIdCp']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.ORDERID}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.billCode']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.BILLINGCODE}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.amount']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.AMOUNT}" >
                                            <f:convertNumber pattern="#0,000" />
                                        </h:outputText>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.requestDate']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.REQUESTDATE}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.infoTran']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.ORDERINFO}" />
                                    </div>
                                </div>
                                <h3>#{lang['searchTransactionBank.detail.infoCustomer']}</h3>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.mobileNumber']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.MSISDN}" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-3">
                                        <label>#{lang['searchTransactionBank.detail.custName']}</label>
                                    </div>
                                    <div class="col-xs-5">
                                        <h:outputText value="#{queryTransactionBean.transDetail.CUSTOMERNAME}" />
                                    </div>
                                </div>
                            </div>
                            <h3>#{lang['searchTransactionBank.detail.history']}</h3>
                            <div id="listTransaction" class="listTransaction">
                                <table style="color: #000000; border-collapse: collapse; border: 1px solid #C5C5C5; margin-left: 10px; border-spacing: 5px;">
                                    <tr style="background-color: #E8E8E8">
                                        <td style="width: 100px">#{lang['searchTransactionBank.detail.typeTran']}</td>
                                        <td style="width: 180px">#{lang['searchTransactionBank.detail.requestIdWriteShort']}</td>
                                        <td style="width: 180px">#{lang['searchTransactionBank.detail.orgRequestId']}</td>
                                        <td style="width: 80px">#{lang['searchTransactionBank.detail.amountWriteShot']}</td>
                                        <td style="width: 200px">#{lang['searchTransactionBank.detail.reqDate']}</td>
                                        <td style="width: 100px">#{lang['searchTransactionBank.detail.status']}</td>
                                    </tr>
                                    <ui:repeat value="#{queryTransactionBean.listTransHis}" var="itemHis">
                                        <tr>
                                            <td>
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.typeTran.payment']}" rendered="#{itemHis.transType == 0}" /> 
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.typeTran.query']}" rendered="#{itemHis.transType == 1}" /> 
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.typeTran.refund']}" rendered="#{itemHis.transType == 2}" /> 
                                            </td>
                                            <td>#{itemHis.transId}</td>
                                            <td>#{itemHis.originalTransId}</td>
                                            <td>
                                                <h:outputText value="#{itemHis.amount}" >
                                                    <f:convertNumber pattern="#0,000" />
                                                </h:outputText>
                                            </td>
                                            <td>#{itemHis.requestDate}</td>
                                            <td>
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.tranStatus.0']}" rendered="#{itemHis.transStatus == 0}" /> 
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.tranStatus.1']}" rendered="#{itemHis.transStatus == 1}" /> 
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.tranStatus.2']}" rendered="#{itemHis.transStatus == 2}" /> 
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.tranStatus.3']}" rendered="#{itemHis.transStatus == 3}" /> 
                                                <h:outputLabel value="#{lang['searchTransactionBank.detail.tranStatus.4']}" rendered="#{itemHis.transStatus == 4}" /> 
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </div>
                        </div>
                </p:dialog>
            </h:form>
        </section>
    </ui:define>
    <script type="text/javascript">
        function start() {
            PF('statusDialog').show();
        }

        function stop() {
            PF('statusDialog').hide();
        }
    </script>
</ui:composition>